#include <Arduino.h>

// Pin definitions for 3 RGB LEDs (using commonly available GPIO pins)
// LED 1 (Left stripe)
const int LED1_RED = 4;
const int LED1_GREEN = 5;
const int LED1_BLUE = 18;

// LED 2 (Middle stripe) 
const int LED2_RED = 19;
const int LED2_GREEN = 21;
const int LED2_BLUE = 22;

// LED 3 (Right stripe)
const int LED3_RED = 23;
const int LED3_GREEN = 25;
const int LED3_BLUE = 26;

// Toggle switch pin
const int TOGGLE_PIN = 2;

// Variables for toggle switch handling
int lastToggleState = HIGH;
int currentToggleState = HIGH;
unsigned long lastDebounceTime = 0;
unsigned long debounceDelay = 50;

// Structure to hold RGB color values
struct Color {
  int red;
  int green;
  int blue;
};

// Structure to hold a complete flag (3 colors)
struct CountryFlag {
  String name;
  Color stripe1;  // Left LED
  Color stripe2;  // Middle LED  
  Color stripe3;  // Right LED
};

// Array of 6 country flags with their 3-stripe color combinations
CountryFlag countries[] = {
  // France (Blue, White, Red)
  {
    "France",
    {0, 35, 149},     // French Blue
    {255, 255, 255},  // White
    {237, 41, 57}     // French Red
  },
  
  // Germany (Black, Red, Gold)
  {
    "Germany", 
    {0, 0, 0},        // Black
    {221, 0, 0},      // German Red
    {255, 206, 0}     // German Gold
  },
  
  // Italy (Green, White, Red)
  {
    "Italy",
    {0, 146, 70},     // Italian Green
    {255, 255, 255},  // White
    {206, 43, 55}     // Italian Red
  },
  
  // Netherlands (Red, White, Blue)
  {
    "Netherlands",
    {174, 28, 40},    // Dutch Red
    {255, 255, 255},  // White  
    {33, 70, 139}     // Dutch Blue
  },
  
  // Russia (White, Blue, Red)
  {
    "Russia",
    {255, 255, 255},  // White
    {0, 57, 166},     // Russian Blue
    {213, 43, 30}     // Russian Red
  },
  
  // Belgium (Black, Yellow, Red)
  {
    "Belgium",
    {0, 0, 0},        // Black
    {253, 218, 36},   // Belgian Yellow
    {237, 41, 57}     // Belgian Red
  }
};

int currentCountryIndex = 0;
int totalCountries = sizeof(countries) / sizeof(countries[0]);

void setup() {
  Serial.begin(115200);
  Serial.println("ESP32 Country Flag Display - 3 RGB LEDs");
  
  // Initialize toggle switch pin
  pinMode(TOGGLE_PIN, INPUT_PULLUP);
  
  // Initialize all RGB LED pins as outputs
  pinMode(LED1_RED, OUTPUT);
  pinMode(LED1_GREEN, OUTPUT);
  pinMode(LED1_BLUE, OUTPUT);
  
  pinMode(LED2_RED, OUTPUT);
  pinMode(LED2_GREEN, OUTPUT);
  pinMode(LED2_BLUE, OUTPUT);
  
  pinMode(LED3_RED, OUTPUT);
  pinMode(LED3_GREEN, OUTPUT);
  pinMode(LED3_BLUE, OUTPUT);
  
  // Display initial country flag
  displayCountryFlag(currentCountryIndex);
  
  Serial.println("Ready! Toggle the switch to cycle through country flags.");
  Serial.println("Current country: " + countries[currentCountryIndex].name);
  Serial.println("Total countries: " + String(totalCountries));
}

void loop() {
  // Read toggle switch with debouncing
  int reading = digitalRead(TOGGLE_PIN);
  
  if (reading != lastToggleState) {
    lastDebounceTime = millis();
  }
  
  if ((millis() - lastDebounceTime) > debounceDelay) {
    if (reading != currentToggleState) {
      currentToggleState = reading;
      
      // Toggle switch was pressed (HIGH to LOW transition)
      if (currentToggleState == LOW) {
        // Move to next country
        currentCountryIndex = (currentCountryIndex + 1) % totalCountries;
        displayCountryFlag(currentCountryIndex);
        
        Serial.println("Toggle pressed! Now displaying: " + countries[currentCountryIndex].name);
        printFlagColors(currentCountryIndex);
      }
    }
  }
  
  lastToggleState = reading;
  delay(10);
}

void displayCountryFlag(int countryIndex) {
  CountryFlag flag = countries[countryIndex];
  
  // Set LED 1 (Left stripe)
  analogWrite(LED1_RED, flag.stripe1.red);
  analogWrite(LED1_GREEN, flag.stripe1.green);
  analogWrite(LED1_BLUE, flag.stripe1.blue);
  
  // Set LED 2 (Middle stripe)
  analogWrite(LED2_RED, flag.stripe2.red);
  analogWrite(LED2_GREEN, flag.stripe2.green);
  analogWrite(LED2_BLUE, flag.stripe2.blue);
  
  // Set LED 3 (Right stripe)  
  analogWrite(LED3_RED, flag.stripe3.red);
  analogWrite(LED3_GREEN, flag.stripe3.green);
  analogWrite(LED3_BLUE, flag.stripe3.blue);
}

void printFlagColors(int countryIndex) {
  CountryFlag flag = countries[countryIndex];
  Serial.println("Flag colors:");
  Serial.println("  Left:   RGB(" + String(flag.stripe1.red) + ", " + String(flag.stripe1.green) + ", " + String(flag.stripe1.blue) + ")");
  Serial.println("  Middle: RGB(" + String(flag.stripe2.red) + ", " + String(flag.stripe2.green) + ", " + String(flag.stripe2.blue) + ")");
  Serial.println("  Right:  RGB(" + String(flag.stripe3.red) + ", " + String(flag.stripe3.green) + ", " + String(flag.stripe3.blue) + ")");
}
